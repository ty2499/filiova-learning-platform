<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduFiliova Real-time Features Demo</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #42fa76, #00d4aa);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .demo-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            background: #f9f9f9;
        }
        .demo-section h3 {
            color: #42fa76;
            margin-top: 0;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status.connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .form-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        button {
            background: #42fa76;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            margin: 5px;
        }
        button:hover {
            background: #3dd865;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .messages {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 15px;
            background: white;
            border-radius: 5px;
        }
        .message {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            border-left: 4px solid #42fa76;
            background: #f0fff0;
        }
        .message.error {
            border-left-color: #dc3545;
            background: #fff0f0;
        }
        .message-time {
            font-size: 12px;
            color: #666;
            float: right;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #42fa76, #00d4aa);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéì EduFiliova Real-time Features Demo</h1>
        
        <div id="connectionStatus" class="status disconnected">
            ‚ùå Disconnected from WebSocket server
        </div>

        <!-- Authentication Section -->
        <div class="demo-section">
            <h3>üîê Authentication</h3>
            <div class="form-group">
                <label for="userId">User ID:</label>
                <input type="text" id="userId" placeholder="Enter your user ID" value="demo-user-123">
            </div>
            <div class="form-group">
                <label for="userRole">Role:</label>
                <select id="userRole">
                    <option value="student">Student</option>
                    <option value="teacher">Teacher</option>
                    <option value="admin">Admin</option>
                </select>
            </div>
            <button onclick="connect()">Connect to WebSocket</button>
            <button onclick="disconnect()">Disconnect</button>
        </div>

        <!-- Real-time Messaging -->
        <div class="demo-section">
            <h3>üí¨ Real-time Messaging</h3>
            <div class="form-group">
                <label for="receiverId">Receiver ID:</label>
                <input type="text" id="receiverId" placeholder="Enter receiver's user ID" value="demo-teacher-456">
            </div>
            <div class="form-group">
                <label for="messageContent">Message (max 2000 chars):</label>
                <textarea id="messageContent" rows="3" placeholder="Type your message here..." maxlength="2000"></textarea>
                <small id="charCount">0/2000 characters</small>
            </div>
            <button onclick="sendMessage()" disabled id="sendMessageBtn">Send Message</button>
        </div>

        <!-- Community Posts -->
        <div class="demo-section">
            <h3>üåç Community Feed</h3>
            <div class="form-group">
                <label for="postTitle">Post Title:</label>
                <input type="text" id="postTitle" placeholder="Enter post title">
            </div>
            <div class="form-group">
                <label for="postContent">Post Content (max 2000 chars):</label>
                <textarea id="postContent" rows="3" placeholder="Share something with the community..." maxlength="2000"></textarea>
            </div>
            <div class="form-group">
                <label for="postSubject">Subject:</label>
                <select id="postSubject">
                    <option value="">All Subjects</option>
                    <option value="Mathematics">Mathematics</option>
                    <option value="Science">Science</option>
                    <option value="English">English</option>
                    <option value="History">History</option>
                </select>
            </div>
            <button onclick="createPost()" disabled id="createPostBtn">Create Post</button>
        </div>

        <!-- Lesson Progress -->
        <div class="demo-section">
            <h3>üìö Lesson Progress</h3>
            <div class="form-group">
                <label for="lessonId">Lesson ID:</label>
                <input type="number" id="lessonId" placeholder="Enter lesson ID" value="1">
            </div>
            <div class="form-group">
                <label for="courseId">Course/Subject ID:</label>
                <input type="text" id="courseId" placeholder="Enter course or subject ID" value="math-101">
            </div>
            <div class="form-group">
                <label for="progressPercent">Progress (%):</label>
                <input type="range" id="progressPercent" min="0" max="100" value="0" onchange="updateProgressDisplay()">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <span id="progressDisplay">0%</span>
            </div>
            <button onclick="updateProgress()" disabled id="updateProgressBtn">Update Progress</button>
            <button onclick="completeLesson()" disabled id="completeLessonBtn">Mark as Complete</button>
        </div>

        <!-- Teacher Notifications -->
        <div class="demo-section">
            <h3>üîî Teacher Notifications</h3>
            <div class="form-group">
                <label for="notificationTitle">Notification Title:</label>
                <input type="text" id="notificationTitle" placeholder="Enter notification title">
            </div>
            <div class="form-group">
                <label for="notificationContent">Notification Content:</label>
                <textarea id="notificationContent" rows="3" placeholder="Type your announcement..."></textarea>
            </div>
            <div class="form-group">
                <label for="targetGrade">Target Grade (optional):</label>
                <input type="number" id="targetGrade" placeholder="Leave empty for all students">
            </div>
            <button onclick="sendNotification()" disabled id="sendNotificationBtn">Send Notification</button>
        </div>

        <!-- Messages Display -->
        <div class="demo-section">
            <h3>üì® Real-time Messages</h3>
            <div id="messagesDisplay" class="messages">
                <p>Connect to WebSocket to see real-time messages...</p>
            </div>
            <button onclick="clearMessages()">Clear Messages</button>
        </div>
    </div>

    <script>
        let ws = null;
        let isConnected = false;

        // Character count for message content
        document.getElementById('messageContent').addEventListener('input', function() {
            const charCount = this.value.length;
            document.getElementById('charCount').textContent = `${charCount}/2000 characters`;
        });

        function connect() {
            const userId = document.getElementById('userId').value;
            const userRole = document.getElementById('userRole').value;
            
            if (!userId) {
                addMessage('Please enter a User ID', 'error');
                return;
            }

            const protocol = window.location.protocol === "https:" ? "wss:" : "ws:";
            const wsUrl = `${protocol}//${window.location.host}/ws`;
            
            ws = new WebSocket(wsUrl);
            
            ws.onopen = function() {
                addMessage('üîó Connected to WebSocket server', 'success');
                updateConnectionStatus(true);
                
                // Authenticate
                ws.send(JSON.stringify({
                    type: 'auth',
                    userId: userId,
                    role: userRole
                }));
            };
            
            ws.onmessage = function(event) {
                const data = JSON.parse(event.data);
                handleWebSocketMessage(data);
            };
            
            ws.onclose = function() {
                addMessage('‚ùå Disconnected from WebSocket server', 'error');
                updateConnectionStatus(false);
            };
            
            ws.onerror = function(error) {
                addMessage('‚ùå WebSocket error: ' + error, 'error');
            };
        }

        function disconnect() {
            if (ws) {
                ws.close();
                ws = null;
            }
            updateConnectionStatus(false);
        }

        function updateConnectionStatus(connected) {
            isConnected = connected;
            const statusEl = document.getElementById('connectionStatus');
            const buttons = ['sendMessageBtn', 'createPostBtn', 'updateProgressBtn', 'completeLessonBtn', 'sendNotificationBtn'];
            
            if (connected) {
                statusEl.textContent = '‚úÖ Connected to WebSocket server';
                statusEl.className = 'status connected';
                buttons.forEach(id => document.getElementById(id).disabled = false);
            } else {
                statusEl.textContent = '‚ùå Disconnected from WebSocket server';
                statusEl.className = 'status disconnected';
                buttons.forEach(id => document.getElementById(id).disabled = true);
            }
        }

        function handleWebSocketMessage(data) {
            switch(data.type) {
                case 'auth_success':
                    addMessage('‚úÖ Authentication successful', 'success');
                    break;
                case 'auth_error':
                    addMessage('‚ùå Authentication failed: ' + data.message, 'error');
                    break;
                case 'new_message':
                    addMessage(`üì® New message from ${data.data.senderId}: ${data.data.content}`, 'info');
                    break;
                case 'message_sent':
                    addMessage('‚úÖ Message sent successfully', 'success');
                    document.getElementById('messageContent').value = '';
                    break;
                case 'message_error':
                    addMessage('‚ùå Message error: ' + data.message, 'error');
                    break;
                case 'new_community_post':
                    addMessage(`üåç New community post: "${data.data.title}" by ${data.data.authorId}`, 'info');
                    break;
                case 'post_created':
                    addMessage('‚úÖ Community post created successfully', 'success');
                    document.getElementById('postTitle').value = '';
                    document.getElementById('postContent').value = '';
                    break;
                case 'post_error':
                    addMessage('‚ùå Post error: ' + data.message, 'error');
                    break;
                case 'progress_updated':
                    addMessage(`üìö Progress updated: ${data.data.progressPercent}%`, 'success');
                    break;
                case 'student_progress_update':
                    addMessage(`üë®‚Äçüéì Student ${data.data.studentId} progress on lesson ${data.data.lessonId}: ${data.data.progress.progressPercent}%`, 'info');
                    break;
                case 'progress_error':
                    addMessage('‚ùå Progress error: ' + data.message, 'error');
                    break;
                case 'teacher_announcement':
                    addMessage(`üîî Teacher announcement: "${data.data.title}" - ${data.data.content}`, 'info');
                    break;
                case 'notification_sent':
                    addMessage('‚úÖ Notification sent to students', 'success');
                    document.getElementById('notificationTitle').value = '';
                    document.getElementById('notificationContent').value = '';
                    break;
                case 'notification_error':
                    addMessage('‚ùå Notification error: ' + data.message, 'error');
                    break;
                case 'rate_limit_exceeded':
                    addMessage('‚ö†Ô∏è Rate limit exceeded. Please slow down.', 'error');
                    break;
                default:
                    addMessage('üì® Received: ' + JSON.stringify(data), 'info');
            }
        }

        function sendMessage() {
            if (!isConnected) return;
            
            const receiverId = document.getElementById('receiverId').value;
            const content = document.getElementById('messageContent').value;
            
            if (!receiverId || !content) {
                addMessage('Please fill in receiver ID and message content', 'error');
                return;
            }
            
            ws.send(JSON.stringify({
                type: 'send_message',
                receiverId: receiverId,
                content: content
            }));
        }

        function createPost() {
            if (!isConnected) return;
            
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;
            const subject = document.getElementById('postSubject').value;
            
            if (!title || !content) {
                addMessage('Please fill in post title and content', 'error');
                return;
            }
            
            ws.send(JSON.stringify({
                type: 'community_post',
                title: title,
                content: content,
                body: content,
                subject: subject
            }));
        }

        function updateProgress() {
            if (!isConnected) return;
            
            const lessonId = document.getElementById('lessonId').value;
            const courseId = document.getElementById('courseId').value;
            const progressPercent = document.getElementById('progressPercent').value;
            
            if (!lessonId || !courseId) {
                addMessage('Please fill in lesson ID and course/subject ID', 'error');
                return;
            }
            
            ws.send(JSON.stringify({
                type: 'lesson_progress',
                lessonId: lessonId,
                courseOrSubjectId: courseId,
                progressPercent: parseInt(progressPercent),
                completed: false
            }));
        }

        function completeLesson() {
            if (!isConnected) return;
            
            const lessonId = document.getElementById('lessonId').value;
            const courseId = document.getElementById('courseId').value;
            
            if (!lessonId || !courseId) {
                addMessage('Please fill in lesson ID and course/subject ID', 'error');
                return;
            }
            
            // Set progress to 100% and mark as complete
            document.getElementById('progressPercent').value = 100;
            updateProgressDisplay();
            
            ws.send(JSON.stringify({
                type: 'lesson_progress',
                lessonId: lessonId,
                courseOrSubjectId: courseId,
                progressPercent: 100,
                completed: true
            }));
        }

        function sendNotification() {
            if (!isConnected) return;
            
            const title = document.getElementById('notificationTitle').value;
            const content = document.getElementById('notificationContent').value;
            const targetGrade = document.getElementById('targetGrade').value;
            
            if (!title || !content) {
                addMessage('Please fill in notification title and content', 'error');
                return;
            }
            
            ws.send(JSON.stringify({
                type: 'teacher_notification',
                title: title,
                content: content,
                targetGrade: targetGrade ? parseInt(targetGrade) : null
            }));
        }

        function updateProgressDisplay() {
            const progress = document.getElementById('progressPercent').value;
            document.getElementById('progressDisplay').textContent = progress + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function addMessage(message, type = 'info') {
            const messagesDiv = document.getElementById('messagesDisplay');
            const messageEl = document.createElement('div');
            messageEl.className = `message ${type}`;
            
            const timeEl = document.createElement('span');
            timeEl.className = 'message-time';
            timeEl.textContent = new Date().toLocaleTimeString();
            
            messageEl.innerHTML = message;
            messageEl.appendChild(timeEl);
            
            messagesDiv.appendChild(messageEl);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function clearMessages() {
            document.getElementById('messagesDisplay').innerHTML = '<p>Messages cleared...</p>';
        }

        // Initialize progress display
        updateProgressDisplay();
    </script>
</body>
</html>